<!doctype html>
<html>
  <head>
    <title>TABLERO</title>
    <link rel="stylesheet" href="css/tablero.css">

  </head>
  <body>
    <script language="javascript" type="text/javascript" src="scripts/libs/p5.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="scripts/utils.js"></script>
    
    <script src="scripts/modelos/TableroModelo.js"></script>
    <script src="scripts/modelos/JugadorModelo.js"></script>
    <script src="scripts/modelos/PacmanModelo.js"></script>
    
    <script src="scripts/vistas/TableroVista.js"></script>
    <script src="scripts/vistas/JugadorVista.js"></script>
    <script src="scripts/vistas/JugadorPuntajeVista.js"></script>
    
    <script src="scripts/controladores/TableroControlador.js"></script>
    <script src="scripts/controladores/Jugadores.js" ></script>
    <script src="scripts/controladores/JugadorControlador.js" ></script>
    
    <!-- <script src="scripts/Pacman.proto.js"></script>
    <script src="scripts/Tablero.js"></script>
    <script src="scripts/pacman.js"></script> -->
    
    <script>
        
        var tablero;
        var jugadores;
        var socket = io();
        
        var celda = 24;
        // TODO: cargar desde JSON
        var config = {
            anchoCelda:celda,
            altoCelda:celda,
            estadoGrilla: [
                [10,14,14,14,14,14,14,14,14,14,14,14,14,18,19,14,14,14,14,14,14,14,14,14,14,14,14,11],
                [16,02,02,02,02,02,02,02,02,02,02,02,02,35,34,02,02,02,02,02,02,02,02,02,02,02,02,15],
                [16,02,24,32,32,25,25,24,32,32,32,25,02,35,34,02,24,32,32,32,25,02,24,32,32,25,02,15],
                [16,02,35,01,01,34,02,35,01,01,01,34,02,35,34,02,35,01,01,01,34,02,35,01,01,34,02,15],
                [16,02,26,33,33,27,02,26,33,33,33,27,02,26,27,02,26,33,33,33,27,02,26,33,33,27,02,15],
                [16,02,02,02,02,02,02,02,02,02,02,02,02,02,02,02,02,02,02,02,02,02,02,02,02,02,02,15],
                [16,02,24,32,32,25,02,24,25,02,24,32,32,32,32,32,32,25,02,24,25,02,24,32,32,25,02,15],
                [16,02,26,33,33,27,02,35,34,02,26,33,33,36,37,33,33,27,02,35,34,02,26,33,33,27,02,15],
                [16,02,02,02,02,02,02,35,34,02,02,02,02,35,34,02,02,02,02,35,34,02,02,02,02,02,02,15],
                [12,17,17,17,17,25,02,35,43,32,32,25,02,35,34,02,24,32,32,42,34,02,24,17,17,17,17,13],
                [01,01,01,01,01,16,02,35,37,33,33,27,02,26,27,02,26,33,33,36,34,02,15,01,01,01,01,01],
                [01,01,01,01,01,16,02,35,34,02,02,02,02,02,02,02,02,02,02,35,34,02,15,01,01,01,01,01],
                [01,01,01,01,01,16,02,35,34,02,28,17,17,02,02,17,17,29,02,35,34,02,15,01,01,01,01,01],
                [14,14,14,14,14,27,02,26,27,02,15,02,02,02,02,02,02,16,02,26,27,02,26,14,14,14,14,14],
                [02,02,02,02,02,02,02,02,02,02,15,02,02,02,02,02,02,16,02,02,02,02,02,02,02,02,02,02],
                [17,17,17,17,17,25,02,24,25,02,15,02,02,02,02,02,02,16,02,24,25,02,24,17,17,17,17,17],
                [01,01,01,01,01,16,02,35,34,02,30,14,14,14,14,14,14,31,02,35,34,02,15,01,01,01,01,01],
                [01,01,01,01,01,16,02,35,34,02,02,02,02,02,02,02,02,02,02,35,34,02,15,01,01,01,01,01],
                [01,01,01,01,01,16,02,35,34,02,24,32,32,32,32,32,32,25,02,35,34,02,15,01,01,01,01,01],
                [10,14,14,14,14,27,02,26,27,02,26,33,33,36,37,33,33,27,02,26,27,02,26,14,14,14,14,11],
                [16,02,02,02,02,02,02,02,02,02,02,02,02,35,34,02,02,02,02,02,02,02,02,02,02,02,02,15],
                [16,02,24,32,32,25,02,24,32,32,32,25,02,35,34,02,24,32,32,32,25,02,24,32,32,25,02,15],
                [16,02,26,33,36,34,02,26,33,33,33,27,02,26,27,02,26,33,33,33,27,02,35,37,33,27,02,15],
                [16,02,02,02,35,34,02,02,02,02,02,02,02,02,02,02,02,02,02,02,02,02,35,34,02,02,02,15],
                [20,32,25,02,35,34,02,24,25,02,24,32,32,32,32,32,32,25,02,24,25,02,35,34,02,24,32,21],
                [22,33,27,02,26,27,02,35,34,02,26,33,33,36,37,33,33,27,02,35,34,02,26,27,02,26,33,23],
                [16,02,02,02,02,02,02,35,34,02,02,02,02,35,34,02,02,02,02,35,34,02,02,02,02,02,02,15],
                [16,02,24,32,32,32,32,42,43,32,32,25,02,35,34,02,24,32,32,42,43,32,32,32,32,25,02,15],
                [16,02,26,33,33,33,33,33,33,33,33,27,02,26,27,02,26,33,33,33,33,33,33,33,33,27,02,15],
                [16,02,02,02,02,02,02,02,02,02,02,02,02,02,02,02,02,02,02,02,02,02,02,02,02,02,02,15],
                [12,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,13]
            ]
        };
          
        var w = config.estadoGrilla[0].length * celda;
        var h = config.estadoGrilla.length * celda;

        socket.on('nuevo jugador tablero', function(jugador){

            jugadores.nuevoJugador(jugador);
        });

        socket.on('comando jugador', function(jugador){
            jugadores.comandoJugador(jugador.id,jugador.dir);
        });

        socket.on('actualizar puntaje',function(jugador){
            jugadores.actualizarPuntaje(jugador.id);
        });

        function setup(){
            
            createCanvas(w,h);
            background(0,0,0);
            frameRate(24);

            try {
                tablero = new TableroControlador(config);
                jugadores = new Jugadores(tablero);
            } catch(e) {
                console.log(e.stack);
            }

        }

        function draw(){

            tablero.dibujar();
            jugadores.actualizar();
            jugadores.dibujar();

        }

    </script>

  </body>
</html>
